version: '3.8'

services:
     db:
       image: postgres:16-alpine
       environment:
         POSTGRES_DB: settings_db
         POSTGRES_USER: postgres
         POSTGRES_PASSWORD: postgres
       ports:
         - "5432:5432"
       volumes:
         - postgres_data:/var/lib/postgresql/data
       healthcheck:
         test: ["CMD-SHELL", "pg_isready -U postgres"]
         interval: 5s
         timeout: 5s
         retries: 5

     backend:
       build: ./backend
       ports:
         - "3001:3001"
       environment:
         DB_HOST: db
         DB_PORT: 5432
         DB_NAME: settings_db
         DB_USER: postgres
         DB_PASSWORD: postgres
         PORT: 3001
       depends_on:
         db:
           condition: service_healthy
       restart: on-failure

     frontend:
       build: ./frontend
       ports:
         - "3000:3000"
       depends_on:
         - backend
       environment:
         - VITE_API_URL=http://backend:3001

volumes:
     postgres_data: